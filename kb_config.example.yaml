mode: custom

aws:
  region: us-east-1
  source_bucket: my-bedrock-kb-source
  source_prefix: kb-docs
  knowledge_base_id: KBXXXXXXXXXX
  data_source_id: DSXXXXXXXXXX
  glue_databases:
    - prod
    - analytics

repositories:
  - name: spark-jobs
    # Use local path OR git_url (+ optional checkout_path)
    path: /path/to/spark-repo
    # git_url: git@github.com:your-org/spark-repo.git
    # git_branch: main
    # checkout_path: .kb_repos/spark-jobs
    git_ref: HEAD
    # Optional override. If missing, default is kb-state/<repo-name>/last_indexed_sha.txt
    # state_key: kb-state/spark-jobs/last_indexed_sha.txt
  - name: flink-jobs
    path: /path/to/flink-repo
    git_ref: HEAD

state:
  # s3: best for cron jobs with fresh clones
  # local: stores per-repo SHA in a local JSON file
  backend: s3
  local_path: .kb_state/state.json
  s3_bucket: my-bedrock-kb-source
  s3_prefix: kb-state

backend:
  # aws_kb | faiss
  type: aws_kb
  aws_kb:
    start_ingestion_job: true
    wait_for_ingestion_job: false
  faiss:
    index_path: .kb_local/index.faiss
    metadata_path: .kb_local/metadata.json
    # hash | sentence_transformers
    embedding_provider: sentence_transformers
    embedding_model: sentence-transformers/all-MiniLM-L6-v2
    embedding_dimension: 384
    normalize_embeddings: true
    bm25_enabled: true
    rrf_k: 60
    rerank_enabled: true
    initial_retrieval_k: 150

planner:
  # heuristic | external_command
  mode: heuristic
  external_command:
    # Command reads JSON context from stdin and returns JSON plan to stdout.
    # Good hook point for Claude Agent SDK or Strands workflows.
    command:

indexing:
  include_extensions:
    - .py
    - .scala
    - .sql
    - .yaml
    - .yml
    - .json
  exclude_dirs:
    - .git
    - .venv
    - venv
    - __pycache__
    - target
    - build
  max_chars_per_doc: 45000
  contextual_retrieval_enabled: true
  contextual_chunk_size_chars: 1800
  contextual_chunk_overlap_chars: 220
  # heuristic | external_command | bedrock | litellm
  contextualizer_mode: heuristic
  # Used by bedrock or litellm contextualizer modes.
  contextualizer_model:
  contextualizer_max_tokens: 220
  contextualizer_temperature: 0.0
  contextualizer_cache_path: .kb_state/context_cache.json
  # Example: uv run python scripts/contextualize_chunk_stub.py
  contextualizer_command:
  contextualizer_max_context_chars: 320
  graph_db_path: .kb_state/graph.db
  impact_reindex_enabled: true

bootstrap:
  knowledge_base_name: de-knowledge-base
  data_source_name: de-repo-source
  bedrock_role_arn: arn:aws:iam::123456789012:role/bedrock-kb-service-role
  embedding_model_arn: arn:aws:bedrock:us-east-1::foundation-model/amazon.titan-embed-text-v2:0
  vector_bucket_name: de-kb-vectors
  vector_index_name: de-kb-index
  vector_dimension: 1024
  vector_distance_metric: cosine
  chunk_lambda_arn: arn:aws:lambda:us-east-1:123456789012:function:bedrock-kb-chunker
  intermediate_s3_uri: s3://my-bedrock-kb-source/bedrock-kb-intermediate/
  context_enrichment_model_arn:
